# Интерфейс IShipyard
Данный интерфейс позволяет управлять процессом строительства новых кораблей. Обычно данный интерфейс реализуют верфи. Верфь имеет следующие ключевые характеристики:
  - **labor_per_sec** - это производственная мощность верфи, т.е. количество работы, выполняемой верфью за единицу времени.

Работа (labor) измеряется в условных единицах, которые символизируют сложность процесса производства. Каждый blueprint имеет имеет аналогичную характеристику, определяющую, сколько работы необходимо затратить на производство предмета.

## Описание интерфейса
```protobuf
message IShipyard {
  enum Status {
    SUCCESS             = 0;
    INTERNAL_ERROR      = 1;

    BUILD_STARTED       = 2;
    BUILD_CANCELED      = 3;
    BUILD_FREEZED       = 4;
    BUILD_FAILED        = 5;
    BLUEPRINT_NOT_FOUND = 6;

    SHIPYARD_IS_BUSY    = 7;
  }

  message Specification {
    double labor_per_sec = 1;
  }
  
  message StartBuild {
    string blueprint_name = 1;
    string ship_name      = 2;
  }

  message ShipBuilt {
    string ship_name = 1;
    uint32 slot_id   = 2;
  }

  oneof choice {
    bool       specification_req = 1;
    StartBuild start_build       = 2;
    bool       cancel_build      = 3;
    
    Specification specification     = 20;
    Status        building_status   = 21;
    double        building_progress = 22;
    ShipBuilt     building_complete = 23;
  }
}
```

## Получение параметров верфи
Для того, чтобы получить параметры верфи, нужно отправить сообщение **specification_req**. В ответ модуль отправит сообщение **Specification**, имеющее следующий тип:
```protobuf
message Specification {
  double labor_per_sec = 1;
}
```
, где:
  - **labor_per_sec ** - количество работы, производимой верфью за единицу времени.

## Запуск строительства кораблей
Чтобы запустить процедуру строительства корабля, нужно отправить сообщение **start_build**, имеющее следующий тип:
```protobuf
message StartBuild {
  string blueprint_name = 1;
  string ship_name      = 2;
}
```
, где:
  - **blueprint_name** - имя чертежа, по которому будет производится строительство;
  - **ship_name** - имя, которое будет выдано кораблю после его постройки.

В ответ на команду поступит сообщение **building_status** с одним из следующих значений:
  - **BUILD_STARTED** - строительство корабля запущено;
  - **SHIPYARD_IS_BUSY** - строительство корабля уже идёт;
  - **BLUEPRINT_NOT_FOUND** - указанный blueprint не существует.

Если строительство корабля запущено, то в процессе строительства верфь будет отправлять извещения о прогрессе.
В случае, если сборка идёт "по плану", верфь будет два раза в секунду отправлять сообщение **building_progress**, в котором указывается процент завершения строительства (от 0 до 1).
В случае, если ресурсов для продолжения строительства недостаточно, верфь начнёт отправлять сообщения **building_status** со статусом **BUILD_FREEZED**.

Когда строительство завершено, верфь отправит сообщение **building_complete**, которое имеет следующий формат:
```protobuf
message ShipBuilt {
  string ship_name = 1;
  uint32 slot_id   = 2;
}
```
, где:
  - **ship_name** - имя построенного корабля;
  - **slot_id** - номер слота на корневом коммутаторе, к которому был подключен построенный корабль.

Сразу после этого к кораблю может быть открыт туннель.

## Расход ресурсов
Используя интерфейс IBlueprintsLibrary, возможно заранее выяснить, какое количество ресурсов необходимо затратить на производство корабля. Все необходимые ресурсы должны быть помещен в контейнер, к которому подключена верфь.
На данный момент модель строительства очень проста, поэтому все ресурсы расходуются одновременно. Если хотя бы один из требуемых ресурсов закончился, сборка корабля **приостанавливается** до тех пор, пока недостающий ресурс не будет загружен в контейнер.

## Отмена сборки
В случае если необходимо отменить сборку корабля, нужно отправить команду **cancel_build**. Команда имеет тип bool, но её значение игнорируется. В ответ модуль отправит сообщение **building_status** с кодом **BUILD_CANCELED**.
